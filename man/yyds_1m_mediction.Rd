% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/yyds_1m_mediction.R
\name{yyds_1m_mediction}
\alias{yyds_1m_mediction}
\title{简单中介分析（一对多，含可视化）}
\usage{
yyds_1m_mediction(
  data,
  xvar,
  med,
  covar,
  outcome,
  time_var = NULL,
  family_type = NULL,
  sims = 100,
  plot_file = "plot_medication",
  plot_ncol = 3
)
}
\arguments{
\item{data}{数据框，包含所有用于分析的变量。}

\item{xvar}{字符型向量，表示多个暴露变量的名称。}

\item{med}{字符串，表示中介变量的名称，可以是二分类或连续变量。}

\item{covar}{字符型向量，表示需要调整的协变量名称。}

\item{outcome}{字符串，表示结局变量的名称。}

\item{time_var}{（可选）字符串，表示生存时间变量，仅在进行生存分析时需要指定。}

\item{family_type}{（可选）字符串，指定用于回归模型的分布族类型，可选值包括 \code{"binomial"}、\code{"gaussian"} 或 \code{"poisson"}。若设置了 \code{time_var}，则不需要此参数。}

\item{sims}{整数，表示中介分析中用于 Bootstrap 的模拟次数，默认为 100。}

\item{plot_file}{（可选）字符串，输出 HTML 可视化图的文件名前缀，默认值为 \code{"plot_medication"}。}

\item{plot_ncol}{（可选）整数，指定每行显示的图数量，默认值为 3。}
}
\value{
返回一个数据框，包含所有变量的中介分析汇总表格（Total effect, ACME, ADE, proportion mediated 等）。
}
\description{
针对多个暴露变量与一个结局变量之间的关系，执行中介分析，并通过指定的中介变量评估间接效应。
支持一般线性模型（GLM）与生存分析（使用 Weibull 回归），并自动输出中介分析表格及 HTML 格式的可视化图。
}
\details{
函数会对每一个 \code{xvar} 中的暴露变量执行一次中介分析，分别构建中介模型与结果模型，并使用 \code{mediation::mediate()} 计算中介效应。
若指定了 \code{time_var}，则使用 \code{survival::survreg()} 拟合 Weibull 生存模型；否则根据 \code{family_type} 使用 \code{glm()} 拟合广义线性模型。

对于每一次分析，函数会输出：
\itemize{
\item Total effect（总效应）
\item ACME（间接效应）
\item ADE（直接效应）
\item Proportion Mediated（中介比例）
\item 模型公式及调用信息
}

若设置了 \code{plot_file}，函数还将生成中介路径图并保存为 HTML 文件。
}
\examples{
# 构造模拟数据
set.seed(123)
n <- 300
data_sim <- data.frame(
  age = rnorm(n, mean = 50, sd = 10),
  bmi = rnorm(n, mean = 25, sd = 4),
  sex = sample(c(0, 1), n, replace = TRUE),     # 0 = female, 1 = male
  smoking = sample(c(0, 1), n, replace = TRUE),
  crp = rnorm(n, mean = 2, sd = 1),             # 中介变量
  followup_years = rexp(n, rate = 0.1),         # 生存时间
  event = rbinom(n, 1, 0.3)                     # 结局（事件发生）
)

# 运行函数示例（生存分析）
result <- yyds_1m_mediction(
  xvar = c("age", "bmi"),
  covar = c("sex", "smoking"),
  med = "crp",
  outcome = "event",
  time_var = "followup_years",
  data = data_sim,
  sims = 50,
  plot_file = "demo_med",
  plot_ncol = 2
)

# 查看结果
print(result)

}

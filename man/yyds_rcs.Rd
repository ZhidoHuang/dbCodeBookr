% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/yyds_rcs.R
\name{yyds_rcs}
\alias{yyds_rcs}
\title{限制性立方样条（RCS）分析可视化函数}
\usage{
yyds_rcs(
  fit,
  ref_zero = TRUE,
  ref = NULL,
  dist_type = c("hist", "density", "none"),
  rug = FALSE,
  color_dist = "#374E55",
  color_rcs = "#F79118"
)
}
\arguments{
\item{fit}{模型对象，支持 \code{rms} 包中的 \code{cph}、\code{lrm} 和 \code{ols}。}

\item{ref_zero}{逻辑值。是否设置参考点并计算相对效应（默认 \code{TRUE}）。
\itemize{
\item \strong{Cox 模型}：若 \code{TRUE}，则 \code{fun = exp}，输出 “Hazard Ratio (vs Ref)”。
\item \strong{Logistic 模型}：若 \code{TRUE}，则 \code{fun = exp} 输出 “Odds Ratio (vs Ref)”；否则 \code{plogis} 输出概率。
\item \strong{线性模型}：若 \code{TRUE}，输出 “Difference in Y (vs Ref)”；否则输出预测值。
}}

\item{ref}{数值型。参考点位置（默认 \code{NULL}，自动使用中位数）。仅在 \code{ref_zero = TRUE} 时生效。}

\item{dist_type}{字符串，控制分布展示方式：
\itemize{
\item \code{"hist"}：直方图（默认）
\item \code{"density"}：密度曲线
\item \code{"none"}：不显示分布
}}

\item{rug}{逻辑值。是否在 x 轴添加地毯图（默认 \code{FALSE}）。}

\item{color_dist}{字符串。分布图颜色（默认 \code{"#374E55"}）。}

\item{color_rcs}{字符串。RCS 曲线颜色（默认 \code{"#F79118"}）。}
}
\value{
返回一个包含以下元素的列表（不可见）：
\itemize{
\item \code{plot}: ggplot2 图形对象（可以调用继续用\pkg{ggplot2}作图）
\item \code{predictions}: 数据框，包含 x 值、预测值及其置信区间
\item 输出RCS_info.txt 文件，记录打印信息
}

结果数据框具有以下属性：
\itemize{
\item \code{p_overall}: 整体 P 值（来自 ANOVA）
\item \code{p_nonlinear}: 非线性 P 值（来自 ANOVA）
\item \code{Inflection_point}: 拐点位置（若检测到）
\item \code{best_knot}: 最佳 knots 数量（若为自动选择）
\item \code{model_type}: 模型类型（"cox"、"logistic"、"linear"）
}
}
\description{
该函数基于 \pkg{rms} 包，对 Cox、Logistic 和线性回归模型中的限制性立方样条（Restricted Cubic Spline, RCS）进行建模分析与可视化。
支持自动选择 knots 数量，支持置信区间、参考点、分布图与非线性检验。
支持模型包括：
\itemize{
\item \code{cph}: Cox 比例风险模型
\item \code{lrm}: Logistic 回归模型
\item \code{ols}: 线性回归模型
}
}
\examples{
\dontrun{
library(rms)

# Cox 模型
# 函数里会提取模型信息重新设置，这里仅为了顺利建模rcs()
options(datadist = NULL)
fit <- cph(Surv(time, status) ~ rcs(age) + sex, data = data)
yyds_rcs(fit)

# Logistic 模型 + 指定参考点
fit <- lrm(death ~ rcs(bmi, 5), data = data)
yyds_rcs(fit, ref_zero = TRUE, ref = 22.5)

# 线性模型，不设置参考点
fit <- ols(y ~ rcs(age, 4), data = data)
yyds_rcs(fit, ref_zero = FALSE)
}

}

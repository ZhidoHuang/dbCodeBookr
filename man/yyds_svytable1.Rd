% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/yyds_svytable1.R
\encoding{UTF-8}
\name{yyds_svytable1}
\alias{yyds_svytable1}
\title{复杂抽样加权基线表}
\usage{
yyds_svytable1(
  design,
  group,
  vars_cont = character(),
  vars_nn_cont = character(),
  vars_categ = character(),
  categ_style = c("number_percent", "Number_percent", "percent", "percent_SE"),
  ci_cont = FALSE,
  ci_nn_cont = FALSE,
  ci_categ = FALSE,
  ci_categ_method = "logit",
  digits_cont = 2,
  digits_categ = 1,
  digits_p = 3,
  show_n = TRUE,
  show_N = TRUE,
  showOverall = TRUE,
  showAllLevels = FALSE
)
}
\arguments{
\item{design}{加权对象。}

\item{group}{分组分层变量。}

\item{vars_cont}{\code{character}。变量名向量（正态分布）。}

\item{vars_nn_cont}{\code{character}。变量名向量（非正态分布）。}

\item{vars_categ}{\code{character}。分类变量名向量（建议确保为因子；其 \code{levels} 决定显示顺序）。}

\item{categ_style}{分类比例的单元格样式，取值：
\itemize{
\item \code{"percent"}：只显示百分比；
\item \code{"number_percent"}：未加权计数 + 百分比（如 \code{n (xx.x)}；
\item \code{"Number_percent"}：加权计数 + 百分比（如 \code{N (xx.x)}；
\item \code{"percent_SE"}：百分比 + SE（如 \code{xx.x (SE)}；
\item 当 \code{ci_categ = TRUE} 时，categ_style被屏蔽。
}}

\item{ci_cont}{\code{logical}。\code{TRUE}=\emph{Mean (95\% CI)}（对正态分布连续变量）。}

\item{ci_nn_cont}{\code{logical}。\code{TRUE}=\emph{Median (95\% CI)}（对非正态分布连续变量）。}

\item{ci_categ}{\code{logical}。分类比例是否显示 95\% CI（若与 \code{se_categ} 同为 \code{TRUE}，CI 优先）。}

\item{ci_categ_method}{\code{character}。使用\code{\link[survey:svyciprop]{survey::svyciprop()}} 计算区间得方法。
\itemize{
\item \code{"logit"}：Logit 变换区间，稳定常用
\item \code{"beta"}：Beta 分布区间，适合比例接近 0/1 或小样本
\item 其余 \code{"likelihood"}, \code{"asin"}, \code{"xlogit"}, \code{"mean"} 见 \code{?survey::svyciprop}
}}

\item{digits_cont}{\code{integer}。连续型数值的小数位数。}

\item{digits_categ}{\code{integer}。比例的小数位数。}

\item{digits_p}{\code{integer}。P 值小数位数。}

\item{show_n}{\code{logical}。是否显示表头未加权样本量 \code{n (unweighted)}。}

\item{show_N}{\code{logical}。是否显示表头加权样本量 \code{N (weighted)}。}

\item{showOverall}{\code{logical}。是否增加 \code{Overall} 列。}

\item{showAllLevels}{\code{logical}。若为 \code{FALSE} 且变量为二分类，仅展示第二个水平 \code{levels(x)[2]}，
并与变量名同行输出；同时在 \code{Test} 列\strong{追加}该水平名（形如 \code{"Yes  |  Rao–Scott chi-square (design-based F)"}）。
如需固定展示“阳性/Yes”，请先把因子水平设为 \code{c("No","Yes")}。}
}
\description{
在 \strong{survey} 复杂抽样设计下，按分组变量一次性生成“基线表”（Table 1）。
支持三类变量：\emph{分类}（比例，可选 95\% CI/SE）、\emph{连续近似正态}（Mean(SE) 或 Mean(95\% CI)）、
\emph{连续非正态}（Median\link{IQR} 或 Median(95\% CI)）；\emph{差异检验}见Details。
}
\details{
\strong{分类变量}
\itemize{
\item 若 \code{ci_categ = TRUE}，展示\emph{Prop (95\% CI)}，用\code{\link[survey:svyciprop]{svyciprop()}}对每个分组子设计计算；
\item 若 \code{categ_style = "percent_SE"}，展示\emph{Prop (SE)}，用\code{\link[survey:svyby]{svyby()}} + \code{\link[survey:surveysummary]{svymean()}}估计；
\item 其他样式使用相应点估计并格式化。
\item P 值：\code{\link[survey:svychisq]{svychisq()}}（\code{statistic = "F"}，Rao–Scott chi-square 的设计型 F 近似）。
\item 二分类合并：当 \code{showAllLevels = FALSE} 时，仅显示 \code{levels(var)[2]}。
}

\strong{连续（近似正态）}
\itemize{
\item 默认\emph{Mean (SE)}，若 \code{ci_nn_cont = TRUE}，展示\emph{Mean (95\% CI)}，通过\code{\link[survey:svyby]{svyby()}} + \code{\link[survey:surveysummary]{svymean()}}（\code{vartype = "se"} 或 \code{"ci"}）计算。
\item P 值：两组用 \code{\link[survey:svyttest]{svyttest()}}；三组及以上用
\code{\link[survey:svyglm]{svyglm()}} + \code{\link[survey:regTermTest]{regTermTest()}}（Wald F）。
}

\strong{连续（非正态）}
\itemize{
\item 默认\emph{Median [Q1, Q3]}，若 \code{ci_nn_cont = TRUE}，展示\emph{Median (95\% CI)}，通过\code{\link[survey:svyby]{svyby()}} + \code{\link[survey:svyquantile]{svyquantile()}} 取 25/50/75\% 分位（或 \code{vartype ="ci"}）；
\item P 值：用\code{\link[survey:svyranktest]{svyranktest()}}参数设置test = "wilcoxon" （两组），或者test = "KruskalWallis" （三组及以上）。
}
}
\examples{
\donttest{
  library(survey)
  data(api)
  dclus1 <- svydesign(id = ~dnum, weights = ~pw, data = apiclus1, fpc = ~fpc)

  # 示例 1：按 stype 分组（分类 + 连续）
  tab1 <- yyds_svytable1(
    design = dclus1,
    group  = "~stype",
    vars_cont    = c("api00"),   # 近似正态 → Mean(SE)
    vars_nn_cont = c("enroll"),  # 非正态 → Median[IQR]
    vars_categ   = c("sch.wide", "comp.imp"),
    categ_style  = "number_percent"
  )
  head(tab1)

  # 示例 2：显示总体列与置信区间
  tab2 <- yyds_svytable1(
    design = dclus1,
    group  = "~stype",
    vars_cont    = c("api00"),
    vars_nn_cont = c("enroll"),
    vars_categ   = c("sch.wide", "comp.imp"),
    ci_cont      = TRUE,
    ci_categ     = TRUE,
    ci_categ_method = "logit",
    show_n       = TRUE,
    show_N       = TRUE,
    showOverall  = FALSE,
    showAllLevels= TRUE,
    digits_categ = 1,
    digits_cont  = 2,
    digits_p     = 3
  )
  head(tab2)
}

}
\seealso{
\code{\link[survey]{svymean}}, \code{\link[survey]{svyciprop}},
\code{\link[survey]{svychisq}}, \code{\link[survey]{svyttest}},
\code{\link[survey]{svyranktest}}, \code{\link[survey]{svyglm}},
\code{\link[survey]{regTermTest}}, \code{\link[survey]{svyquantile}}
}

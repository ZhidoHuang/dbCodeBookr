% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/yyds_svytable1.R
\encoding{UTF-8}
\name{yyds_svytable1}
\alias{yyds_svytable1}
\title{创建复杂抽样加权的基线表}
\usage{
yyds_svytable1(
  design,
  group,
  vars_cont = character(),
  vars_nn_cont = character(),
  vars_categ = character(),
  categ_style = c("number_percent", "Number_percent", "percent", "percent_SE"),
  ci_cont = FALSE,
  ci_nn_cont = FALSE,
  ci_categ = FALSE,
  ci_categ_method = "logit",
  digits_cont = 2,
  digits_categ = 1,
  digits_p = 3,
  show_n = TRUE,
  show_N = TRUE,
  showOverall = TRUE,
  showAllLevels = FALSE
)
}
\arguments{
\item{design}{加权对象。}

\item{group}{分组分层变量。}

\item{vars_cont}{\code{character}，变量名向量（正态连续型）。}

\item{vars_nn_cont}{\code{character}，变量名向量（非正态连续型）。}

\item{vars_categ}{\code{character}，分类变量名向量（建议确保为因子；其 \code{levels} 决定显示顺序）。}

\item{categ_style}{\code{character}，分类比例的单元格样式，取值：
\itemize{
\item \code{"number_percent"}：n(\%)（n为未加权计数）；
\item \code{"Number_percent"}：N(\%)（N为加权计数）；
\item \code{"percent"}：\%；
\item \code{"percent_SE"}：\%(se)；
\item 若 \code{ci_categ = TRUE} 优先展示 \%(95\% CI)。
}}

\item{ci_cont}{\code{logical}，\code{TRUE}展示Mean (95\% CI)（对正态分布连续变量）。}

\item{ci_nn_cont}{\code{logical}，\code{TRUE}展示Median (95\% CI)（对非正态分布连续变量）。}

\item{ci_categ}{\code{logical}，分类比例是否显示 95\% CI。}

\item{ci_categ_method}{\code{character}，c("logit","beta","likelihood", "asin","xlogit","mean")，具体见\code{\link[survey:svyciprop]{svyciprop()}}。}

\item{digits_cont}{\code{integer}，连续型数值的小数位数。}

\item{digits_categ}{\code{integer}，比例的小数位数。}

\item{digits_p}{\code{integer}，P 值小数位数。}

\item{show_n}{\code{logical}，是否显示表头未加权样本量n。}

\item{show_N}{\code{logical}，是否显示表头加权样本量N。}

\item{showOverall}{\code{logical}，是否增加 \code{Overall} 列。}

\item{showAllLevels}{\code{logical}，\code{FALSE} 所有二分类变量，仅展示一个水平信息。
\itemize{
\item 默认展示第2类目（默认顺序0/1，N/Y，no/yes，Famle/Male）；如需固定展示如Famle，先把因子水平设为 \code{c("Male","Famle")}。
\item 同时在 \code{Test} 列追加类目信息。
}}
}
\description{
在 \strong{survey} 包复杂抽样设计下，创建一个便于在医学研究论文中使用的描述性表格。
支持三类变量，展示形式可选：
\itemize{
\item \strong{分类}：n(\%)，N(\%)，\%，\%(se)，或 \%(95\% CI)；
\item \strong{正态连续型}：Mean(SE)，或 Mean(95\% CI)；
\item \strong{非正态连续型}：Median[IQR]，或 Median(95\% CI)。
\item \strong{差异检验}：见\strong{Details}。
}
}
\details{
\strong{分类变量}
\itemize{
\item 若 \code{ci_categ = TRUE}，展示 Prop (95\% CI)，用 \code{\link[survey]{svyciprop}(\dots, method = "logit")} 对每个分组子设计计算；
\item 若 \code{categ_style = "percent_SE"}，展示Prop (SE)，用 svyby(…, svymean, vartype = "se")估计；
\item P 值：用 Rao–Scott χ² (design-based F)，通过 svychisq(…, statistic = "F")实现。
}

\strong{连续（近似正态）}
\itemize{
\item 默认展示Mean (SE)，通过svyby(…, svymean, vartype = "se")计算；
\item 若 \code{ci_nn_cont = TRUE}，通过svyby(…, svymean, vartype = "ci")计算；
\item P 值：两组用svyttest()；三组及以上用svyglm() + regTermTest()（Wald F）。
}

\strong{连续（非正态）}
\itemize{
\item 默认展示Median [Q1, Q3]，通过svyby(…, svyquantile, quantiles = c(.25,.5,.75))实现；
\item 若 \code{ci_nn_cont = TRUE}，展示Median (95\% CI)，通过svyby(…, svyquantile, quantiles =0.5, vartype ="ci")实现；
\item P 值：用"wilcoxon" （两组）或"KruskalWallis" （三组及以上）,通过svyranktest(…, test = "wilcoxon")实现。
}
}
\examples{
\donttest{
  library(survey)
  data(api)
  dclus1 <- svydesign(id = ~dnum, weights = ~pw, data = apiclus1, fpc = ~fpc)

  # 示例 1：按 stype 分组（分类 + 连续）
  tab1 <- yyds_svytable1(
    design = dclus1,
    group  = "~stype",
    vars_cont    = c("api00"),   # 近似正态 → Mean(SE)
    vars_nn_cont = c("enroll"),  # 非正态 → Median[IQR]
    vars_categ   = c("sch.wide", "comp.imp"),
    categ_style  = "number_percent"
  )
  head(tab1)

  # 示例 2：显示总体列与置信区间
  tab2 <- yyds_svytable1(
    design = dclus1,
    group  = "~stype",
    vars_cont    = c("api00"),
    vars_nn_cont = c("enroll"),
    vars_categ   = c("sch.wide", "comp.imp"),
    ci_cont      = TRUE,
    ci_categ     = TRUE,
    ci_categ_method = "logit",
    show_n       = TRUE,
    show_N       = TRUE,
    showOverall  = FALSE,
    showAllLevels= TRUE,
    digits_categ = 1,
    digits_cont  = 2,
    digits_p     = 3
  )
  head(tab2)
}

}
\seealso{
\code{\link[survey]{svymean}}, \code{\link[survey]{svyciprop}},
\code{\link[survey]{svychisq}}, \code{\link[survey]{svyttest}},
\code{\link[survey]{svyranktest}}, \code{\link[survey]{svyglm}},
\code{\link[survey]{regTermTest}}, \code{\link[survey]{svyquantile}}
}
